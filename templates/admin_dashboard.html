<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Landbank CIMS</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Base styles consistent with previous designs */
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            /* Update this path if the image is in a different location on Render */
            background: url('/static/assets/landbank-BG.png') no-repeat center center/cover;
            z-index: -1;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #385E38; /* Fallback dark green */
            color: #fff;
            min-height: 100vh; /* Ensure body covers full height */
            display: flex;
            flex-direction: column; /* Allow content to stack */
            align-items: center; /* Center horizontally */
            padding: 1rem; /* Overall padding */
            box-sizing: border-box; /* Include padding in element's total width */
        }
        .container {
            margin-top: 32px;
            margin-bottom: 32px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 2rem 1rem;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 2;
            width: 100%; /* Take full width within its flex context */
            max-width: 1200px; /* Max width for larger screens */
        }
        /* Responsive adjustments for container */
        @media (max-width: 991.98px) {
            .container {
                padding: 1.5rem 1rem;
            }
        }
        @media (max-width: 575.98px) {
            .container {
                padding: 1rem 0.5rem;
                border-radius: 0; /* Make corners less rounded on very small screens */
            }
        }

        /* Table specific styles */
        .table {
            color: #fff;
            width: 100%; /* Ensure table takes full width */
            margin-top: 20px; /* Space above table */
        }
        .table th, .table td {
            vertical-align: middle;
            border-color: rgba(255, 255, 255, 0.3);
            padding: 0.75rem; /* Default padding for cells */
        }
        .table-dark {
            background-color: rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            color: #fff;
            padding-bottom: 15px;
            border-bottom: 1.5px solid rgba(255, 255, 255, 0.5);
            flex-wrap: wrap; /* Allow items to wrap */
        }
        .header h2 {
            color: #fff;
            font-weight: bold;
            flex-grow: 1; /* Allow title to take available space */
            margin-bottom: 0; /* Remove default margin for better alignment */
        }
        .header form {
            margin-left: auto; /* Push logout button to the right */
        }
        @media (max-width: 767.98px) {
            .header {
                flex-direction: column; /* Stack on small screens */
                align-items: center;
            }
            .header h2 {
                text-align: center;
                margin-bottom: 15px; /* Add space below title when stacked */
            }
            .header form {
                margin-left: 0; /* Remove auto margin when stacked */
                width: 100%; /* Make logout button full width */
                text-align: center;
            }
        }

        /* Button styles */
        .btn-logout {
            background: linear-gradient(to right, #00B86B, #008f53);
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border: none;
            transition: all 0.3s ease;
        }
        .btn-logout:hover {
            background: linear-gradient(to right, #008f53, #00B86B);
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
        }
        .btn-action {
            margin-right: 5px;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            white-space: nowrap; /* Prevent button text from wrapping */
            min-width: 90px; /* Ensure buttons are wide enough for tapping */
        }
        .btn-action:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
        }
        .btn-view {
            background: linear-gradient(to right, #17a2b8, #138496);
            color: white;
        }
        .btn-view:hover {
            background: linear-gradient(to right, #138496, #17a2b8);
        }
        .btn-edit {
            background: linear-gradient(to right, #ffc107, #e0a800);
            color: #212529;
        }
        .btn-edit:hover {
            background: linear-gradient(to right, #e0a800, #ffc107);
            color: #212529;
        }
        .btn-danger {
            background: linear-gradient(to right, #dc3545, #c82333);
            color: white;
        }
        .btn-danger:hover {
            background: linear-gradient(to right, #c82333, #dc3545);
        }
        .text-center {
            color: #fff;
        }

        /* Search and Filter Form */
        .form-control, .form-select {
            background-color: rgba(255, 255, 255, 0.15); /* Slightly transparent input fields */
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            font-weight: 500;
        }
        .form-control::placeholder, .form-select option {
            color: rgba(255, 255, 255, 0.7);
        }
        .form-control:focus, .form-select:focus {
            background-color: rgba(255, 255, 255, 0.25);
            border-color: #90EE90; /* Light green focus border */
            box-shadow: 0 0 0 0.25rem rgba(144, 238, 144, 0.25);
            color: #fff;
        }
        .input-group-text {
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
        }
        .form-label { /* Ensure labels are visible if not visually-hidden */
            color: #fff;
        }

        /* Shiny Button Effect (applied to new buttons) */
        .shiny-btn {
            position: relative;
            overflow: hidden;
            color: #fff;
            border: none;
            outline: none;
            transition: background 0.3s, box-shadow 0.3s, transform 0.2s;
            box-shadow: 0 0 15px rgba(0,0,0,0.08);
        }
        .shiny-btn:before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
            z-index: 1;
        }
        .shiny-btn:hover:before {
            left: 100%;
        }
        .shiny-btn:active {
            transform: translateY(1px);
        }
        /* Color variants for shiny buttons */
        .btn-primary.shiny-btn {
            background: linear-gradient(90deg, #00B86B 0%, #008f53 100%);
        }
        .btn-secondary.shiny-btn {
            background: linear-gradient(90deg, #6c757d 0%, #495057 100%);
        }
        .btn-danger.shiny-btn {
            background: linear-gradient(90deg, #dc3545 0%, #b02a37 100%);
        }
        .btn-view.shiny-btn {
            background: linear-gradient(90deg, #17a2b8 0%, #138496 100%);
        }
        .btn-edit.shiny-btn {
            background: linear-gradient(90deg, #ffc107 0%, #e0a800 100%);
            color: #212529; /* Darker text for yellow buttons */
        }
        .btn-logout.shiny-btn {
            background: linear-gradient(90deg, #00B86B 0%, #008f53 100%);
        }

        /* Table responsiveness improvements */
        @media (max-width: 991.98px) { /* Medium devices and smaller */
            .table thead {
                display: none; /* Hide table headers on small screens */
            }
            .table, .table tbody, .table tr, .table td {
                display: block; /* Make table elements behave like blocks */
                width: 100%; /* Full width */
            }
            .table tr {
                margin-bottom: 1rem;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                background-color: rgba(255, 255, 255, 0.05); /* Card-like background */
            }
            .table td {
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                position: relative;
                padding-left: 50%; /* Make space for pseudo-element labels */
                text-align: right;
            }
            .table td:before {
                content: attr(data-label); /* Use data-label for content */
                position: absolute;
                left: 10px;
                width: calc(50% - 20px); /* Adjust width for padding */
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: rgba(255, 255, 255, 0.7);
            }
            .table td:last-child {
                border-bottom: 0;
            }
            /* Specific adjustments for action buttons */
            .table td:nth-last-child(1) { /* Target the Action column */
                text-align: center; /* Center the action buttons */
                padding-left: 10px; /* Reset padding */
            }
            .table td:nth-last-child(1):before {
                content: ''; /* Remove pseudo-element for action column */
                display: none;
            }
            .d-flex.justify-content-center.align-items-center.gap-1 {
                flex-wrap: wrap; /* Allow buttons to wrap */
                justify-content: center !important; /* Force center alignment */
                gap: 8px !important; /* Adjust gap for wrapped buttons */
                min-width: unset !important; /* Remove min-width from parent */
            }
            .btn-action {
                flex: 1 1 auto; /* Allow buttons to grow/shrink, distribute space */
                max-width: 100%; /* Ensure they don't overflow */
                margin: 0; /* Remove specific margins */
            }
        }

        /* Form Modal Styles (from Add Customer Modal) */
        .modal-content {
            background-color: #385E38; /* Dark green background */
            color: #fff; /* White text for modal content */
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        .modal-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        .modal-title {
            color: #fff;
            font-weight: bold;
        }
        .btn-close {
            filter: invert(1); /* Make close button white */
        }
        .modal-body .form-label {
            color: #fff; /* Labels inside modal forms */
        }
        .modal-body .form-control,
        .modal-body .form-select {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            color: #fff;
        }
        .modal-body .form-control:focus,
        .modal-body .form-select:focus {
            border-color: #90EE90;
            box-shadow: 0 0 0 0.25rem rgba(144, 238, 144, 0.25);
        }
        .modal-body .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        .modal-body hr {
            border-top: 1px dashed rgba(255, 255, 255, 0.3);
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .modal-body strong {
            color: #90EE90; /* Light green for section titles */
        }
        .btn-success {
            background: linear-gradient(to right, #28a745, #218838);
            border-color: #28a745;
            color: white;
            font-weight: bold;
        }
        .btn-success:hover {
            background: linear-gradient(to right, #218838, #28a745);
            border-color: #218838;
        }

        /* Badge styles for status column */
        .badge {
            padding: 0.5em 0.8em;
            border-radius: 0.5rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 0.3em;
        }

        /* User-requested modal scrollability */
        .modal-dialog-scrollable .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }
        .no-records {
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-top: 1rem;
        }
        /* Styles for checkbox group in modal */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #fff; /* Ensure label text is white */
        }
        .checkbox-group input[type="checkbox"] {
            /* Basic styling, can be customized further */
            width: 1.1em;
            height: 1.1em;
            accent-color: #00B86B; /* Green accent color */
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    <div class="container">
        <div class="header">
            <h2>Admin Dashboard</h2>
            <form action="{{ url_for('logout') }}" method="POST">
                <button class="btn btn-logout shiny-btn">Logout</button>
            </form>
        </div>

        <!-- Search, Filter, and Actions Controls -->
        <form method="get" action="{{ url_for('admin_dashboard_page') }}" class="row g-2 align-items-end mb-4">
            <div class="col-md-4 col-12">
                <label for="search" class="form-label visually-hidden">Search</label>
                <div class="input-group">
                    <span class="input-group-text" id="search-addon"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" id="search" name="search" placeholder="Search customers..." value="{{ request.args.get('search', '') }}" aria-label="Search customers">
                </div>
            </div>
            <div class="col-md-2 col-6">
                <label for="status" class="form-label visually-hidden">Status</label>
                <select class="form-select" id="status" name="status" aria-label="Filter by status">
                    <option value="">All Statuses</option>
                    <option value="Active" {% if request.args.get('status') == 'Active' %}selected{% endif %}>Active</option>
                    <option value="Pending" {% if request.args.get('status') == 'Pending' %}selected{% endif %}>Pending</option>
                    <option value="Inactive" {% if request.args.get('status') == 'Inactive' %}selected{% endif %}>Inactive</option>
                </select>
            </div>
            <div class="col-md-2 col-6">
                <label for="reg_date" class="form-label visually-hidden">Registration Date</label>
                <input type="date" class="form-control" id="reg_date" name="reg_date" value="{{ request.args.get('reg_date', '') }}" aria-label="Filter by registration date">
            </div>
            <div class="col-md-2 col-4 d-grid">
                <button type="submit" class="btn btn-secondary shiny-btn w-100 py-2" style="font-size: 1rem;" title="Apply Filters" aria-label="Apply Filters">
                    <i class="fas fa-filter"></i> Apply
                </button>
            </div>
            <div class="col-md-2 col-4 d-grid">
                <a href="{{ url_for('admin_dashboard_page') }}" class="btn btn-secondary shiny-btn w-100 py-2" style="font-size: 1rem;" title="Refresh" aria-label="Refresh filters">
                    <i class="fas fa-sync-alt"></i> Refresh
                </a>
            </div>
            <div class="col-md-2 col-4 d-grid ms-md-auto">
                <button type="button" class="btn btn-primary shiny-btn w-100 py-2" style="font-size: 1rem;" data-bs-toggle="modal" data-bs-target="#addCustomerModal" aria-label="Add Customer">
                    <i class="fas fa-user-plus"></i> Add Customer
                </button>
            </div>
        </form>

        <h4>Registered Customers</h4>
        <div class="table-responsive">
            <table class="table table-bordered table-hover align-middle mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Customer No</th>
                        <th>Full Name</th>
                        <th>Email Address</th>
                        <th>Contact No</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for customer in customers %}
                    <tr>
                        <td data-label="#">{{ loop.index }}</td>
                        <td data-label="Customer No">{{ customer.cust_no }}</td>
                        <td data-label="Full Name">{{ customer.custname }}</td>
                        <td data-label="Email Address">{{ customer.email_address }}</td>
                        <td data-label="Contact No">{{ customer.contact_no }}</td>
                        <td data-label="Status">
                            {% set status = customer.status or 'Active' %} {# Ensure status exists #}
                            {% if status == 'Active' %}
                            <span class="badge bg-success"><i class="fas fa-check-circle"></i> Active</span>
                            {% elif status == 'Pending' %}
                            <span class="badge bg-warning text-dark"><i class="fas fa-hourglass-half"></i> Pending</span>
                            {% elif status == 'Inactive' %}
                            <span class="badge bg-secondary"><i class="fas fa-ban"></i> Inactive</span>
                            {% else %}
                            <span class="badge bg-light text-dark">{{ status }}</span>
                            {% endif %}
                        </td>
                        <td data-label="Action">
                            <div class="d-flex justify-content-center align-items-center gap-1">
                                <a href="{{ url_for('admin_view_customer', cust_no=customer.cust_no) }}" class="btn btn-view btn-sm btn-action shiny-btn d-flex align-items-center">
                                    <i class="fas fa-eye"></i> <span class="ms-1">View</span>
                                </a>
                                <a href="{{ url_for('admin_edit_customer', cust_no=customer.cust_no) }}" class="btn btn-edit btn-sm btn-action shiny-btn d-flex align-items-center">
                                    <i class="fas fa-edit"></i> <span class="ms-1">Edit</span>
                                </a>
                                <form action="{{ url_for('delete_customer') }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this customer?');" style="display:inline;">
                                    <input type="hidden" name="cust_no" value="{{ customer.cust_no }}">
                                    <button type="submit" class="btn btn-danger btn-sm btn-action shiny-btn d-flex align-items-center">
                                        <i class="fas fa-trash-alt"></i> <span class="ms-1">Delete</span>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="text-center">No customers found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <form action="{{ url_for('admin_add_customer') }}" method="POST">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addCustomerModalLabel"><i class="fas fa-user-plus"></i> Add New Customer</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row g-3">
                            <!-- Personal Info -->
                            <div class="col-12"><hr><strong>Personal Information</strong></div>
                            <div class="col-md-6">
                                <label class="form-label">First Name</label>
                                <input type="text" name="firstName" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Last Name</label>
                                <input type="text" name="lastName" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Date of Birth</label>
                                <input type="date" name="datebirth" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Nationality</label>
                                <input type="text" name="nationality" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Citizenship</label>
                                <input type="text" name="citizenship" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Sex</label>
                                <select name="custsex" class="form-select" required>
                                    <option value="">Select Sex</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Place of Birth</label>
                                <input type="text" name="placebirth" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Civil Status</label>
                                <select name="civilstatus" class="form-select" required>
                                    <option value="">Select Civil Status</option>
                                    <option value="Single">Single</option>
                                    <option value="Married">Married</option>
                                    <option value="Divorced">Divorced</option>
                                    <option value="Widowed">Widowed</option>
                                    <option value="Separated">Separated</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Number of Children</label>
                                <input type="number" name="num_children" class="form-control" min="0" value="0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Mother's Maiden Name</label>
                                <input type="text" name="mmaiden_name" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Address</label>
                                <input type="text" name="cust_address" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email Address</label>
                                <input type="email" name="email_address" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Contact No</label>
                                <input type="tel" name="contact_no" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Registration Status</label>
                                <select name="registration_status" class="form-select" required>
                                    <option value="Active">Active</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                            </div>

                            <!-- Spouse Info -->
                            <div class="col-12"><hr><strong>Spouse Information</strong></div>
                            <div class="col-md-4">
                                <label class="form-label">Spouse Name</label>
                                <input type="text" name="sp_name" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Spouse Date of Birth</label>
                                <input type="date" name="sp_datebirth" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Spouse Profession</label>
                                <input type="text" name="sp_profession" class="form-control">
                            </div>

                            <!-- Employment Info -->
                            <div class="col-12"><hr><strong>Employment Information</strong></div>
                            <div class="col-md-6">
                                <label class="form-label">Occupation Type</label>
                                <select name="occ_type" id="add_occupationType" class="form-select">
                                    <option value="">Select Occupation</option>
                                    <option value="Employed">Employed</option>
                                    <option value="Self-employed">Self-employed</option>
                                    <option value="OFW/Overseas Filipino">OFW/Overseas Filipino</option>
                                    <option value="Retired">Retired</option>
                                    <option value="Farmer/Fisher">Farmer/Fisher</option>
                                    <option value="Student/Minor">Student/Minor</option>
                                    <option value="Unemployed">Unemployed</option>
                                    <option value="Housewife">Housewife</option>
                                    <option value="Lawyers/Notary/Independent Legal Professional/Accountant">Lawyers/Notary/Independent Legal Professional/Accountant</option>
                                    <option value="Government Official">Government Official</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Nature of Business/Economic Activity</label>
                                <select name="bus_nature" id="add_natureBusiness" class="form-select">
                                    <option value="">Select Nature of Business</option>
                                    <option value="1700">1700 - Private Household with Employed Persons</option>
                                    <option value="1800">1800 - Extra-territorial Organizations and Bodies</option>
                                    <option value="1204">1204 - Jewelry and Precious Stones Dealer</option>
                                    <option value="1005">1005 - Foreign Exchange Dealer Money Changer/ Remittance Agent</option>
                                    <option value="A0103">A0103 - Agriculture, Forestry, and Fishing</option>
                                    <option value="B0609">B0609 - Mining and Quarrying</option>
                                    <option value="C1033">C1033 - Manufacturing</option>
                                    <option value="D3500">D3500 - Electricity, Gas, Steam, and Air-conditioning Supply</option>
                                    <option value="E3639">E3639 - Water Supply, Sewerage, Waste Management and Remediation Activities </option>
                                    <option value="F4143">F4143 - Construction </option>
                                    <option value="G4547">G4547 - Wholesale and Retail Trade, Repair of Motor Vehicles and Motorcycles</option>
                                    <option value="H4953">H4953 - Transportation and Storage</option>
                                    <option value="I5556">I5556 - Accommodation and Food Service Activities</option>
                                    <option value="J5863">J5863 - Information and Communication</option>
                                    <option value="K6466">K6466 - Financial and Insurance Activities</option>
                                    <option value="L800">L800 - Real Estate Activities</option>
                                    <option value="M6975">M6975 - Professional, Scientific, and Technical Activities</option>
                                    <option value="N7782">N7782 - Administrative and Support Service Activities</option>
                                    <option value="O6400">O6400 - Public Administrative and Defense, Compulsory Social Security</option>
                                    <option value="P8500">P8500 - Education</option>
                                    <option value="Q8688">Q8688 - Human Health and Social Work Activities</option>
                                    <option value="R9093">R9093 - Arts, Entertainment, and Recreation</option>
                                    <option value="S9496">S9496 - Other Service Activities (Activities of Membership Organizations)</option>
                                    <option value="T9798">T9798 - Activities of Private Households as Employers and Undifferentiated Goods and Service and Producing Activities of Households for own use</option>
                                    <option value="U9900">U9900 - Activities of Extraterritorial Organizations, and Bodies </option>
                                    <option value="V0000">V0000 - Others</option>
                                    <option value="V0001">V0001 - Others - Student/Minor/Retiree/Pensioner</option>
                                    <option value="V0002">V0002 - Others - Unemployed/Housewife</option>
                                    <option value="9200">9200 - Gambling and Betting Activities</option>
                                    <option value="9210">9210 - OGOs and OGO Service Providers</option>
                                    <option value="9220">9220 - Casinos</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">TIN ID</label>
                                <input type="text" name="tin_id" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Company Name</label>
                                <input type="text" name="empname" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Employer Address</label>
                                <input type="text" name="emp_address" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Phone/Fax No</label>
                                <input type="tel" name="phonefax_no" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Job Title</label>
                                <input type="text" name="job_title" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Employment Date</label>
                                <input type="date" name="emp_date" class="form-control">
                            </div>

                            <!-- Financial Info -->
                            <div class="col-12"><hr><strong>Financial Information</strong></div>
                            <div class="col-12">
                                <label class="form-label">Source of Wealth (Select up to 3)</label>
                                <div class="checkbox-group" id="sourceOfWealthCheckboxes">
                                    <label><input type="checkbox" name="source_wealth[]" value="Salary/Honoraria"> Salary/Honoraria</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Interest/Commission"> Interest/Commission</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Business"> Business</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Pension"> Pension</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Regular Remittance"> Regular Remittance</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Other Remittance"> Other Remittance</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Donations/Inheritance"> Donations/Inheritance</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Allowance"> Allowance</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Professional Fees - Others"> Professional Fees - Others</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Professional Fees - Lawyers/Notary/Independent"> Professional Fees - Lawyers/Notary/Independent</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Grant/Scholarship/Awards/Prizes/Benefits"> Grant/Scholarship/Awards/Prizes/Benefits</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Royalties/Commission"> Royalties/Commission</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Sale of Assets"> Sale of Assets</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Loans"> Loans</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Government Appropriations"> Government Appropriations</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Fees and Charges"> Fees and Charges</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Taxes and Licenses"> Taxes and Licenses</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Others - with documents"> Others - with documents</label>
                                    <label><input type="checkbox" name="source_wealth[]" value="Others - without documents"> Others - without documents</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Monthly Gross Income/Pension/Allowance</label>
                                <select name="mon_income" id="monthlyIncome" class="form-select" required>
                                    <option value="">Select Monthly Income</option>
                                    <option value="30000_and_below">Php 30,000.00 and below</option>
                                    <option value="30000_01_to_50000">Php 30,000.01-50,000.00</option>
                                    <option value="50000_01_to_100000">Php 50,000.01-100,000.00</option>
                                    <option value="100000_01_to_500000">Php 100,000.01-500,000.00</option>
                                    <option value="over_500000">Over Php 500,000.00</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Annual Gross Income/Pension/Allowance</label>
                                <select name="ann_income" id="annualIncome" class="form-select" required>
                                    <option value="">Select Annual Income</option>
                                    <option value="360000_and_below">Php 360,000.00 and below</option>
                                    <option value="360000_01_to_600000">Php 360,000.01-600,000.00</option>
                                    <option value="600000_01_to_1200000">Php 600,000.01-1,200,000.00</option>
                                    <option value="1200000_01_to_6000000">Php 1,200,000.01-6,000,000.00</option>
                                    <option value="over_6000000">Over Php 6,000,000.00</option>
                                </select>
                            </div>

                            <!-- Company Affiliations -->
                            <div class="col-12"><hr><strong>Company Affiliations</strong></div>
                            <div id="modal_company_affiliations_list" class="col-12 dynamic-list">
                                <div class="row g-2 align-items-end mb-2 dynamic-list-item">
                                    <div class="col-md-5">
                                        <label class="form-label">Role</label>
                                        <input type="text" name="depositor_role[]" class="form-control" placeholder="e.g., Shareholder">
                                    </div>
                                    <div class="col-md-5">
                                        <label class="form-label">Company Name</label>
                                        <input type="text" name="dep_compname[]" class="form-control" placeholder="e.g., ABC Corp">
                                    </div>
                                    <div class="col-md-2 d-flex justify-content-end">
                                        <button type="button" class="btn btn-danger btn-sm remove-item-btn"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                                <p class="no-records-message" style="display: none;">No records listed.</p>
                            </div>
                            <div class="col-12 text-end">
                                <button type="button" class="btn btn-info btn-sm shiny-btn" id="add_company_affiliation"><i class="fas fa-plus"></i> Add Affiliation</button>
                            </div>

                            <!-- Existing Bank Accounts -->
                            <div class="col-12"><hr><strong>Existing Bank Accounts</strong></div>
                            <div id="modal_existing_banks_list" class="col-12 dynamic-list">
                                <div class="row g-2 align-items-end mb-2 dynamic-list-item">
                                    <div class="col-md-4">
                                        <label class="form-label">Bank Name</label>
                                        <input type="text" name="bank_name[]" class="form-control" placeholder="e.g., BPI">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Branch</label>
                                        <input type="text" name="branch[]" class="form-control" placeholder="e.g., Makati">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Account Type</label>
                                        <input type="text" name="acc_type[]" class="form-control" placeholder="e.g., Savings">
                                    </div>
                                    <div class="col-md-1 d-flex justify-content-end">
                                        <button type="button" class="btn btn-danger btn-sm remove-item-btn"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                                <p class="no-records-message" style="display: none;">No records listed.</p>
                            </div>
                            <div class="col-12 text-end">
                                <button type="button" class="btn btn-info btn-sm shiny-btn" id="add_existing_bank"><i class="fas fa-plus"></i> Add Bank</button>
                            </div>

                            <!-- Public Official Relationships -->
                            <div class="col-12"><hr><strong>Public Official Relationships</strong></div>
                            <div id="modal_public_official_relationships_list" class="col-12 dynamic-list">
                                <div class="row g-2 align-items-end mb-2 dynamic-list-item">
                                    <div class="col-md-3">
                                        <label class="form-label">Official Name</label>
                                        <input type="text" name="gov_int_name[]" class="form-control" placeholder="e.g., Juan Dela Cruz">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Official Position</label>
                                        <input type="text" name="official_position[]" class="form-control" placeholder="e.g., Mayor">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Branch/Org</label>
                                        <input type="text" name="branch_orgname[]" class="form-control" placeholder="e.g., LGU Manila">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Relationship</label>
                                        <select name="relation_desc[]" class="form-select">
                                            <option value="">Select Relationship</option>
                                            <option value="Father">Father</option>
                                            <option value="Mother">Mother</option>
                                            <option value="Mother-in- Law">Mother-in-Law</option>
                                            <option value="Father-in-Law">Father-in-Law</option>
                                            <option value="Son">Son</option>
                                            <option value="Daughter">Daughter</option>
                                            <option value="Son-in-Law">Son-in-Law</option>
                                            <option value="Daughter-in-Law">Daughter-in-Law</option>
                                            <option value="Brother">Brother</option>
                                            <option value="Sister">Sister</option>
                                            <option value="Sibling">Sibling</option>
                                            <option value="Brother-in-Law">Brother-in-Law</option>
                                            <option value="Sister-in-Law">Sister-in-Law</option>
                                            <option value="Grandfather">Grandfather</option>
                                            <option value="Grandmother">Grandmother</option>
                                            <option value="Granddaughter">Granddaughter</option>
                                            <option value="Grandson">Grandson</option>
                                            <option value="Uncle">Uncle</option>
                                            <option value="Aunt">Aunt</option>
                                            <option value="Nephew">Nephew</option>
                                            <option value="Niece">Niece</option>
                                            <option value="Cousin">Cousin</option>
                                            <option value="Spouse">Spouse</option>
                                            <option value="Partner">Partner</option>
                                            <option value="Guardian">Guardian</option>
                                            <option value="Ward">Ward</option>
                                            <option value="Other Relative">Other Relative</option>
                                            <option value="Friend">Friend</option>
                                            <option value="Business Associate">Business Associate</option>
                                        </select>
                                    </div>
                                    <div class="col-md-1 d-flex justify-content-end">
                                        <button type="button" class="btn btn-danger btn-sm remove-item-btn"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                                <p class="no-records-message" style="display: none;">No records listed.</p>
                            </div>
                            <div class="col-12 text-end">
                                <button type="button" class="btn btn-info btn-sm shiny-btn" id="add_public_official_relationship"><i class="fas fa-plus"></i> Add PO Relationship</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary shiny-btn" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success shiny-btn"><i class="fas fa-save"></i> Save Customer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Customer Modal (Existing, keeping as is) -->
    <div class="modal fade" id="viewCustomerModal" tabindex="-1" aria-labelledby="viewCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewCustomerModalLabel">Customer Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Customer details will be loaded here via JavaScript -->
                    <div id="customerDetailsContent">
                        <h6 class="mb-3 text-white">Personal Information</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4"><strong>Last Name:</strong> <span id="view_lastName"></span></div>
                            <div class="col-md-4"><strong>Middle Name:</strong> <span id="view_middleName"></span></div>
                            <div class="col-md-4"><strong>First Name:</strong> <span id="view_firstName"></span></div>
                            <div class="col-md-4"><strong>Date of Birth:</strong> <span id="view_dob"></span></div>
                            <div class="col-md-4"><strong>Nationality:</strong> <span id="view_nationality"></span></div>
                            <div class="col-md-4"><strong>Citizenship:</strong> <span id="view_citizenship"></span></div>
                            <div class="col-md-4"><strong>Sex:</strong> <span id="view_sex"></span></div>
                            <div class="col-md-4"><strong>Civil Status:</strong> <span id="view_civilStatus"></span></div>
                            <div class="col-md-4"><strong>Contact Number:</strong> <span id="view_contactNo"></span></div>
                            <div class="col-md-6"><strong>Email Address:</strong> <span id="view_emailAddress"></span></div>
                            <div class="col-md-6"><strong>Present Address:</strong> <span id="view_presentAddress"></span></div>
                        </div>
                        <hr>
                        <h6 class="mb-3 text-white">Employment Information</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6"><strong>Occupation:</strong> <span id="view_occupation"></span></div>
                            <div class="col-md-6"><strong>Nature of Business:</strong> <span id="view_natureOfBusiness"></span></div>
                            <div class="col-md-6"><strong>Monthly Income:</strong> <span id="view_monthlyIncome"></span></div>
                            <div class="col-md-6"><strong>Source of Income:</strong> <span id="view_sourceOfIncome"></span></div>
                        </div>
                        <hr>
                        <h6 class="mb-3 text-white">Financial Information</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6"><strong>Fund Source:</strong> <span id="view_fundSource"></span></div>
                            <div class="col-md-6"><strong>Purpose of Account:</strong> <span id="view_purposeOfAccount"></span></div>
                            <div class="col-12"><strong>Source of Wealth:</strong> <span id="view_sourceOfWealth"></span></div>
                        </div>
                        <hr>
                        <h6 class="mb-3 text-white">Company Affiliations</h6>
                        <div id="view_company_affiliations_list">
                            <p class="no-records-message" style="display: block;">No records listed.</p>
                        </div>
                        <hr>
                        <h6 class="mb-3 text-white">Existing Bank Accounts</h6>
                        <div id="view_existing_banks_list">
                            <p class="no-records-message" style="display: block;">No records listed.</p>
                        </div>
                        <hr>
                        <h6 class="mb-3 text-white">Relationship to Public Official/International Organization</h6>
                        <div id="view_public_official_relationships_list">
                            <p class="no-records-message" style="display: block;">No records listed.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Customer Modal (Existing, keeping as is, but field names adjusted) -->
    <div class="modal fade" id="editCustomerModal" tabindex="-1" aria-labelledby="editCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editCustomerModalLabel">Edit Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editCustomerForm">
                        <input type="hidden" id="edit_customerId" name="customerId">
                        <h6 class="mb-3 text-white">Personal Information</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label for="edit_firstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="edit_firstName" name="firstName" required>
                            </div>
                            <div class="col-md-4">
                                <label for="edit_lastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="edit_lastName" name="lastName" required>
                            </div>
                            <div class="col-md-4">
                                <label for="edit_datebirth" class="form-label">Date of Birth</label>
                                <input type="date" class="form-control" id="edit_datebirth" name="datebirth" required>
                            </div>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label for="edit_nationality" class="form-label">Nationality</label>
                                <input type="text" class="form-control" id="edit_nationality" name="nationality" required>
                            </div>
                            <div class="col-md-4">
                                <label for="edit_citizenship" class="form-label">Citizenship</label>
                                <input type="text" class="form-control" id="edit_citizenship" name="citizenship" required>
                            </div>
                            <div class="col-md-4">
                                <label for="edit_custsex" class="form-label">Sex</label>
                                <select class="form-select" id="edit_custsex" name="custsex" required>
                                    <option value="">Select Sex</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label for="edit_placebirth" class="form-label">Place of Birth</label>
                                <input type="text" class="form-control" id="edit_placebirth" name="placebirth" required>
                            </div>
                            <div class="col-md-4">
                                <label for="edit_civilstatus" class="form-label">Civil Status</label>
                                <select class="form-select" id="edit_civilstatus" name="civilstatus" required>
                                    <option value="">Select Civil Status</option>
                                    <option value="Single">Single</option>
                                    <option value="Married">Married</option>
                                    <option value="Divorced">Divorced</option>
                                    <option value="Widowed">Widowed</option>
                                    <option value="Separated">Separated</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="edit_num_children" class="form-label">Number of Children</label>
                                <input type="number" class="form-control" id="edit_num_children" name="num_children" min="0">
                            </div>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit_mmaiden_name" class="form-label">Mother's Maiden Name</label>
                                <input type="text" class="form-control" id="edit_mmaiden_name" name="mmaiden_name" required>
                            </div>
                            <div class="col-md-6">
                                <label for="edit_cust_address" class="form-label">Address</label>
                                <input type="text" class="form-control" id="edit_cust_address" name="cust_address" required>
                            </div>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit_email_address" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="edit_email_address" name="email_address" required>
                            </div>
                            <div class="col-md-6">
                                <label for="edit_contact_no" class="form-label">Contact No</label>
                                <input type="tel" class="form-control" id="edit_contact_no" name="contact_no" required>
                            </div>
                        </div>
                         <div class="col-md-6">
                            <label for="edit_registration_status" class="form-label">Registration Status</label>
                            <select name="registration_status" id="edit_registration_status" class="form-select" required>
                                <option value="Active">Active</option>
                                <option value="Pending">Pending</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>

                        <hr>
                        <h6 class="mb-3 text-white">Spouse Information</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label for="edit_sp_name" class="form-label">Spouse Name</label>
                                <input type="text" id="edit_sp_name" name="sp_name" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label for="edit_sp_datebirth" class="form-label">Spouse Date of Birth</label>
                                <input type="date" id="edit_sp_datebirth" name="sp_datebirth" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label for="edit_sp_profession" class="form-label">Spouse Profession</label>
                                <input type="text" id="edit_sp_profession" name="sp_profession" class="form-control">
                            </div>
                        </div>

                        <hr>
                        <h6 class="mb-3 text-white">Employment Information</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit_occ_type" class="form-label">Occupation Type</label>
                                <select name="occ_type" id="edit_occ_type" class="form-select">
                                    <option value="">Select Occupation</option>
                                    <option value="Employed">Employed</option>
                                    <option value="Self-employed">Self-employed</option>
                                    <option value="OFW/Overseas Filipino">OFW/Overseas Filipino</option>
                                    <option value="Retired">Retired</option>
                                    <option value="Farmer/Fisher">Farmer/Fisher</option>
                                    <option value="Student/Minor">Student/Minor</option>
                                    <option value="Unemployed">Unemployed</option>
                                    <option value="Housewife">Housewife</option>
                                    <option value="Lawyers/Notary/Independent Legal Professional/Accountant">Lawyers/Notary/Independent Legal Professional/Accountant</option>
                                    <option value="Government Official">Government Official</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="edit_bus_nature" class="form-label">Nature of Business/Economic Activity</label>
                                <select name="bus_nature" id="edit_bus_nature" class="form-select">
                                    <option value="">Select Nature of Business</option>
                                    <option value="1700">1700 - Private Household with Employed Persons</option>
                                    <option value="1800">1800 - Extra-territorial Organizations and Bodies</option>
                                    <option value="1204">1204 - Jewelry and Precious Stones Dealer</option>
                                    <option value="1005">1005 - Foreign Exchange Dealer Money Changer/ Remittance Agent</option>
                                    <option value="A0103">A0103 - Agriculture, Forestry, and Fishing</option>
                                    <option value="B0609">B0609 - Mining and Quarrying</option>
                                    <option value="C1033">C1033 - Manufacturing</option>
                                    <option value="D3500">D3500 - Electricity, Gas, Steam, and Air-conditioning Supply</option>
                                    <option value="E3639">E3639 - Water Supply, Sewerage, Waste Management and Remediation Activities </option>
                                    <option value="F4143">F4143 - Construction </option>
                                    <option value="G4547">G4547 - Wholesale and Retail Trade, Repair of Motor Vehicles and Motorcycles</option>
                                    <option value="H4953">H4953 - Transportation and Storage</option>
                                    <option value="I5556">I5556 - Accommodation and Food Service Activities</option>
                                    <option value="J5863">J5863 - Information and Communication</option>
                                    <option value="K6466">K6466 - Financial and Insurance Activities</option>
                                    <option value="L800">L800 - Real Estate Activities</option>
                                    <option value="M6975">M6975 - Professional, Scientific, and Technical Activities</option>
                                    <option value="N7782">N7782 - Administrative and Support Service Activities</option>
                                    <option value="O6400">O6400 - Public Administrative and Defense, Compulsory Social Security</option>
                                    <option value="P8500">P8500 - Education</option>
                                    <option value="Q8688">Q8688 - Human Health and Social Work Activities</option>
                                    <option value="R9093">R9093 - Arts, Entertainment, and Recreation</option>
                                    <option value="S9496">S9496 - Other Service Activities (Activities of Membership Organizations)</option>
                                    <option value="T9798">T9798 - Activities of Private Households as Employers and Undifferentiated Goods and Service and Producing Activities of Households for own use</option>
                                    <option value="U9900">U9900 - Activities of Extraterritorial Organizations, and Bodies </option>
                                    <option value="V0000">V0000 - Others</option>
                                    <option value="V0001">V0001 - Others - Student/Minor/Retiree/Pensioner</option>
                                    <option value="V0002">V0002 - Others - Unemployed/Housewife</option>
                                    <option value="9200">9200 - Gambling and Betting Activities</option>
                                    <option value="9210">9210 - OGOs and OGO Service Providers</option>
                                    <option value="9220">9220 - Casinos</option>
                                </select>
                            </div>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label for="edit_tin_id" class="form-label">TIN ID</label>
                                <input type="text" name="tin_id" class="form-control" id="edit_tin_id">
                            </div>
                            <div class="col-md-4">
                                <label for="edit_empname" class="form-label">Company Name</label>
                                <input type="text" name="empname" class="form-control" id="edit_empname">
                            </div>
                            <div class="col-md-4">
                                <label for="edit_emp_address" class="form-label">Employer Address</label>
                                <input type="text" name="emp_address" class="form-control" id="edit_emp_address">
                            </div>
                            <div class="col-md-4">
                                <label for="edit_phonefax_no" class="form-label">Phone/Fax No</label>
                                <input type="tel" name="phonefax_no" class="form-control" id="edit_phonefax_no">
                            </div>
                            <div class="col-md-4">
                                <label for="edit_job_title" class="form-label">Job Title</label>
                                <input type="text" name="job_title" class="form-control" id="edit_job_title">
                            </div>
                            <div class="col-md-4">
                                <label for="edit_emp_date" class="form-label">Employment Date</label>
                                <input type="date" name="emp_date" class="form-control" id="edit_emp_date">
                            </div>
                        </div>

                        <hr>
                        <h6 class="mb-3 text-white">Financial Information</h6>
                        <div class="col-12">
                            <label class="form-label">Source of Wealth (Select up to 3)</label>
                            <div class="checkbox-group" id="editSourceOfWealthCheckboxes">
                                <label><input type="checkbox" name="source_wealth[]" value="Salary/Honoraria"> Salary/Honoraria</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Interest/Commission"> Interest/Commission</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Business"> Business</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Pension"> Pension</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Regular Remittance"> Regular Remittance</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Other Remittance"> Other Remittance</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Donations/Inheritance"> Donations/Inheritance</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Allowance"> Allowance</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Professional Fees - Others"> Professional Fees - Others</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Professional Fees - Lawyers/Notary/Independent"> Professional Fees - Lawyers/Notary/Independent</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Grant/Scholarship/Awards/Prizes/Benefits"> Grant/Scholarship/Awards/Prizes/Benefits</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Royalties/Commission"> Royalties/Commission</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Sale of Assets"> Sale of Assets</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Loans"> Loans</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Government Appropriations"> Government Appropriations</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Fees and Charges"> Fees and Charges</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Taxes and Licenses"> Taxes and Licenses</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Others - with documents"> Others - with documents</label>
                                <label><input type="checkbox" name="source_wealth[]" value="Others - without documents"> Others - without documents</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="edit_mon_income" class="form-label">Monthly Gross Income/Pension/Allowance</label>
                            <select name="mon_income" id="edit_mon_income" class="form-select" required>
                                <option value="">Select Monthly Income</option>
                                <option value="30000_and_below">Php 30,000.00 and below</option>
                                <option value="30000_01_to_50000">Php 30,000.01-50,000.00</option>
                                <option value="50000_01_to_100000">Php 50,000.01-100,000.00</option>
                                <option value="100000_01_to_500000">Php 100,000.01-500,000.00</option>
                                <option value="over_500000">Over Php 500,000.00</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="edit_ann_income" class="form-label">Annual Gross Income/Pension/Allowance</label>
                            <select name="ann_income" id="edit_ann_income" class="form-select" required>
                                <option value="">Select Annual Income</option>
                                <option value="360000_and_below">Php 360,000.00 and below</option>
                                <option value="360000_01_to_600000">Php 360,000.01-600,000.00</option>
                                <option value="600000_01_to_1200000">Php 600,000.01-1,200,000.00</option>
                                <option value="1200000_01_to_6000000">Php 1,200,000.01-6,000,000.00</option>
                                <option value="over_6000000">Over Php 6,000,000.00</option>
                            </select>
                        </div>

                        <hr>
                        <h6 class="mb-3 text-white">Company Affiliations</h6>
                        <div id="edit_company_affiliations_list" class="col-12 dynamic-list">
                            <!-- Dynamic items will be loaded here -->
                            <p class="no-records-message" style="display: none;">No records listed.</p>
                        </div>
                        <div class="col-12 text-end">
                            <button type="button" class="btn btn-info btn-sm shiny-btn" id="edit_add_company_affiliation"><i class="fas fa-plus"></i> Add Affiliation</button>
                        </div>

                        <hr>
                        <h6 class="mb-3 text-white">Existing Bank Accounts</h6>
                        <div id="edit_existing_banks_list" class="col-12 dynamic-list">
                            <!-- Dynamic items will be loaded here -->
                            <p class="no-records-message" style="display: none;">No records listed.</p>
                        </div>
                        <div class="col-12 text-end">
                            <button type="button" class="btn btn-info btn-sm shiny-btn" id="edit_add_existing_bank"><i class="fas fa-plus"></i> Add Bank</button>
                        </div>

                        <hr>
                        <h6 class="mb-3 text-white">Public Official Relationships</h6>
                        <div id="edit_public_official_relationships_list" class="col-12 dynamic-list">
                            <!-- Dynamic items will be loaded here -->
                            <p class="no-records-message" style="display: none;">No records listed.</p>
                        </div>
                        <div class="col-12 text-end">
                            <button type="button" class="btn btn-info btn-sm shiny-btn" id="edit_add_public_official_relationship"><i class="fas fa-plus"></i> Add PO Relationship</button>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary shiny-btn" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary shiny-btn" form="editCustomerForm"><i class="fas fa-save"></i> Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Customer Confirmation Modal -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this customer record? This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <form id="deleteCustomerForm" method="POST" action="">
                        <input type="hidden" name="cust_no" id="delete_customerId">
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to add a new item to a dynamic list
            function addDynamicListItem(listId, templateHtml) {
                const listContainer = document.getElementById(listId);
                const newItemDiv = document.createElement('div');
                newItemDiv.innerHTML = templateHtml;
                newItemDiv.classList.add('row', 'g-2', 'align-items-end', 'mb-2', 'dynamic-list-item');
                
                // Add remove button event listener
                newItemDiv.querySelector('.remove-item-btn').addEventListener('click', function() {
                    newItemDiv.remove();
                    checkAndAddNoRecordsMessage(listContainer);
                });

                // Remove "No records listed." message if present
                const noRecordsMessage = listContainer.querySelector('.no-records-message');
                if (noRecordsMessage) {
                    noRecordsMessage.style.display = 'none';
                }

                listContainer.appendChild(newItemDiv);
                checkAndAddNoRecordsMessage(listContainer); // Re-check after adding
            }

            // Function to check if a list is empty and show/hide "No records" message
            function checkAndAddNoRecordsMessage(listContainer) {
                const items = listContainer.querySelectorAll('.dynamic-list-item');
                let noRecordsMessage = listContainer.querySelector('.no-records-message');

                if (!noRecordsMessage) {
                    noRecordsMessage = document.createElement('p');
                    noRecordsMessage.className = 'no-records-message';
                    noRecordsMessage.textContent = 'No records listed.';
                    listContainer.appendChild(noRecordsMessage);
                }

                if (items.length === 0) {
                    noRecordsMessage.style.display = 'block';
                } else {
                    noRecordsMessage.style.display = 'none';
                }
            }


            // Templates for new dynamic list items (matching your Python backend's expected name attributes)
            const companyAffiliationTemplate = `
                <div class="col-md-5">
                    <label class="form-label">Role</label>
                    <input type="text" name="depositor_role[]" class="form-control" placeholder="e.g., Shareholder">
                </div>
                <div class="col-md-5">
                    <label class="form-label">Company Name</label>
                    <input type="text" name="dep_compname[]" class="form-control" placeholder="e.g., ABC Corp">
                </div>
                <div class="col-md-2 d-flex justify-content-end">
                    <button type="button" class="btn btn-danger btn-sm remove-item-btn"><i class="fas fa-times"></i></button>
                </div>
            `;

            const existingBankTemplate = `
                <div class="col-md-4">
                    <label class="form-label">Bank Name</label>
                    <input type="text" name="bank_name[]" class="form-control" placeholder="e.g., BPI">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Branch</label>
                    <input type="text" name="branch[]" class="form-control" placeholder="e.g., Makati">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Account Type</label>
                    <input type="text" name="acc_type[]" class="form-control" placeholder="e.g., Savings">
                </div>
                <div class="col-md-1 d-flex justify-content-end">
                    <button type="button" class="btn btn-danger btn-sm remove-item-btn"><i class="fas fa-times"></i></button>
                </div>
            `;

            const publicOfficialRelationshipTemplate = `
                <div class="col-md-3">
                    <label class="form-label">Official Name</label>
                    <input type="text" name="gov_int_name[]" class="form-control" placeholder="e.g., Juan Dela Cruz">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Official Position</label>
                    <input type="text" name="official_position[]" class="form-control" placeholder="e.g., Mayor">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Branch/Org</label>
                    <input type="text" name="branch_orgname[]" class="form-control" placeholder="e.g., LGU Manila">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Relationship</label>
                    <select name="relation_desc[]" class="form-select">
                        <option value="">Select Relationship</option>
                        <option value="Father">Father</option>
                        <option value="Mother">Mother</option>
                        <option value="Mother-in- Law">Mother-in-Law</option>
                        <option value="Father-in-Law">Father-in-Law</option>
                        <option value="Son">Son</option>
                        <option value="Daughter">Daughter</option>
                        <option value="Son-in-Law">Son-in-Law</option>
                        <option value="Daughter-in-Law">Daughter-in-Law</option>
                        <option value="Brother">Brother</option>
                        <option value="Sister">Sister</option>
                        <option value="Sibling">Sibling</option>
                        <option value="Brother-in-Law">Brother-in-Law</option>
                        <option value="Sister-in-Law">Sister-in-Law</option>
                        <option value="Grandfather">Grandfather</option>
                        <option value="Grandmother">Grandmother</option>
                        <option value="Granddaughter">Granddaughter</option>
                        <option value="Grandson">Grandson</option>
                        <option value="Uncle">Uncle</option>
                        <option value="Aunt">Aunt</option>
                        <option value="Nephew">Nephew</option>
                        <option value="Niece">Niece</option>
                        <option value="Cousin">Cousin</option>
                        <option value="Spouse">Spouse</option>
                        <option value="Partner">Partner</option>
                        <option value="Guardian">Guardian</option>
                        <option value="Ward">Ward</option>
                        <option value="Other Relative">Other Relative</option>
                        <option value="Friend">Friend</option>
                        <option value="Business Associate">Business Associate</option>
                    </select>
                </div>
                <div class="col-md-1 d-flex justify-content-end">
                    <button type="button" class="btn btn-danger btn-sm remove-item-btn"><i class="fas fa-times"></i></button>
                </div>
            `;

            // --- Add Customer Modal Dynamic Fields ---
            const addCustomerModal = document.getElementById('addCustomerModal');
            if (addCustomerModal) {
                // Initial check for 'No records listed.' messages on modal open
                addCustomerModal.addEventListener('show.bs.modal', function() {
                    checkAndAddNoRecordsMessage(document.getElementById('modal_company_affiliations_list'));
                    checkAndAddNoRecordsMessage(document.getElementById('modal_existing_banks_list'));
                    checkAndAddNoRecordsMessage(document.getElementById('modal_public_official_relationships_list'));
                });

                // Add Company Affiliation
                document.getElementById('add_company_affiliation').addEventListener('click', function() {
                    addDynamicListItem('modal_company_affiliations_list', companyAffiliationTemplate);
                });

                // Add Bank Account
                document.getElementById('add_existing_bank').addEventListener('click', function() {
                    addDynamicListItem('modal_existing_banks_list', existingBankTemplate);
                });

                // Add Relationship to Public Official
                document.getElementById('add_public_official_relationship').addEventListener('click', function() {
                    addDynamicListItem('modal_public_official_relationships_list', publicOfficialRelationshipTemplate);
                });

                // Source of Wealth Checkbox Limit for Add Customer Modal
                addCustomerModal.addEventListener('change', function(event) {
                    if (event.target.name === 'source_wealth[]' && event.target.type === 'checkbox') {
                        const checkedCount = addCustomerModal.querySelectorAll('input[name="source_wealth[]"]:checked').length;
                        if (checkedCount > 3) {
                            event.target.checked = false;
                            // Provide user feedback without using alert()
                            let messageContainer = addCustomerModal.querySelector('#sourceOfWealthMessage');
                            if (!messageContainer) {
                                const parentDiv = event.target.closest('.checkbox-group');
                                if (parentDiv) {
                                    messageContainer = document.createElement('div');
                                    messageContainer.id = 'sourceOfWealthMessage';
                                    messageContainer.classList.add('text-warning', 'mt-2'); // Bootstrap classes for warning text
                                    parentDiv.parentNode.appendChild(messageContainer);
                                }
                            }
                            if (messageContainer) {
                                messageContainer.textContent = 'You can select up to three sources of wealth only.';
                                setTimeout(() => {
                                    messageContainer.textContent = ''; // Clear message after 3 seconds
                                }, 3000);
                            }
                        } else {
                            // Clear message if count is <= 3
                            const messageContainer = addCustomerModal.querySelector('#sourceOfWealthMessage');
                            if (messageContainer) {
                                messageContainer.textContent = '';
                            }
                        }
                    }
                });
            }

            // --- View Customer Modal ---
            const viewCustomerModal = document.getElementById('viewCustomerModal');
            if (viewCustomerModal) {
                viewCustomerModal.addEventListener('show.bs.modal', function (event) {
                    const button = event.relatedTarget; // Button that triggered the modal
                    // In your Flask app, you will need an endpoint like /api/customer/<uuid:cust_no>
                    // that returns JSON data for a specific customer.
                    const customerId = button.getAttribute('data-customer-id'); 

                    fetch(`/admin/customer/${customerId}`) // Assuming this Flask route exists and returns JSON
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            // Populate personal info fields
                            // Assuming your customer_data from Flask populates these fields directly
                            document.getElementById('view_firstName').textContent = data.customer.custname.split(' ')[0] || 'N/A';
                            document.getElementById('view_lastName').textContent = data.customer.custname.split(' ')[1] || 'N/A';
                            document.getElementById('view_dob').textContent = data.customer.datebirth || 'N/A';
                            document.getElementById('view_nationality').textContent = data.customer.nationality || 'N/A';
                            document.getElementById('view_citizenship').textContent = data.customer.citizenship || 'N/A';
                            document.getElementById('view_sex').textContent = data.customer.custsex || 'N/A';
                            document.getElementById('view_civilStatus').textContent = data.customer.civilstatus || 'N/A';
                            document.getElementById('view_contactNo').textContent = data.customer.contact_no || 'N/A';
                            document.getElementById('view_emailAddress').textContent = data.customer.email_address || 'N/A';
                            document.getElementById('view_presentAddress').textContent = data.customer.cust_address || 'N/A';
                            document.getElementById('view_num_children').textContent = data.customer.num_children || '0';
                            document.getElementById('view_mmaiden_name').textContent = data.customer.mmaiden_name || 'N/A';

                            // Populate employment info fields
                            document.getElementById('view_occupation').textContent = data.occupation.occ_type || 'N/A';
                            document.getElementById('view_natureOfBusiness').textContent = data.occupation.bus_nature || 'N/A';
                            
                            // Employer details if applicable
                            if (data.employer_details) {
                                document.getElementById('view_tin_id').textContent = data.employer_details.tin_id || 'N/A';
                                document.getElementById('view_empname').textContent = data.employer_details.empname || 'N/A';
                                document.getElementById('view_emp_address').textContent = data.employer_details.emp_address || 'N/A';
                                document.getElementById('view_phonefax_no').textContent = data.employer_details.phonefax_no || 'N/A';
                                document.getElementById('view_job_title').textContent = data.employer_details.job_title || 'N/A';
                                document.getElementById('view_emp_date').textContent = data.employer_details.emp_date || 'N/A';
                            } else {
                                // Clear if not employed or no data
                                document.getElementById('view_tin_id').textContent = 'N/A';
                                document.getElementById('view_empname').textContent = 'N/A';
                                document.getElementById('view_emp_address').textContent = 'N/A';
                                document.getElementById('view_phonefax_no').textContent = 'N/A';
                                document.getElementById('view_job_title').textContent = 'N/A';
                                document.getElementById('view_emp_date').textContent = 'N/A';
                            }

                            // Populate financial info fields
                            document.getElementById('view_sourceOfWealth').textContent = data.financial_record.source_wealth || 'N/A';
                            document.getElementById('view_monthlyIncome').textContent = data.financial_record.mon_income || 'N/A';
                            document.getElementById('view_annualIncome').textContent = data.financial_record.ann_income || 'N/A';

                            // Populate Spouse details
                            if (data.spouse) {
                                document.getElementById('view_sp_name').textContent = data.spouse.sp_name || 'N/A';
                                document.getElementById('view_sp_datebirth').textContent = data.spouse.sp_datebirth || 'N/A';
                                document.getElementById('view_sp_profession').textContent = data.spouse.sp_profession || 'N/A';
                            } else {
                                document.getElementById('view_sp_name').textContent = 'N/A';
                                document.getElementById('view_sp_datebirth').textContent = 'N/A';
                                document.getElementById('view_sp_profession').textContent = 'N/A';
                            }

                            // Populate Company Affiliations
                            const viewCompanyAffiliationsList = document.getElementById('view_company_affiliations_list');
                            viewCompanyAffiliationsList.innerHTML = ''; // Clear previous content
                            if (data.company_affiliations && data.company_affiliations.length > 0) {
                                data.company_affiliations.forEach(aff => {
                                    const affDiv = document.createElement('div');
                                    affDiv.innerHTML = `<p><strong>Role:</strong> ${aff.depositor_role || 'N/A'}, <strong>Company:</strong> ${aff.dep_compname || 'N/A'}</p>`;
                                    viewCompanyAffiliationsList.appendChild(affDiv);
                                });
                            }
                            checkAndAddNoRecordsMessage(viewCompanyAffiliationsList);


                            // Populate Existing Bank Accounts
                            const viewExistingBanksList = document.getElementById('view_existing_banks_list');
                            viewExistingBanksList.innerHTML = ''; // Clear previous content
                            if (data.existing_banks && data.existing_banks.length > 0) {
                                data.existing_banks.forEach(bank => {
                                    const bankDiv = document.createElement('div');
                                    bankDiv.innerHTML = `<p><strong>Bank:</strong> ${bank.bank_name || 'N/A'}, <strong>Branch:</strong> ${bank.branch || 'N/A'}, <strong>Account Type:</strong> ${bank.acc_type || 'N/A'}</p>`;
                                    viewExistingBanksList.appendChild(bankDiv);
                                });
                            }
                            checkAndAddNoRecordsMessage(viewExistingBanksList);


                            // Populate Public Official Relationships
                            const viewPublicOfficialRelationshipsList = document.getElementById('view_public_official_relationships_list');
                            viewPublicOfficialRelationshipsList.innerHTML = ''; // Clear previous content
                            if (data.public_official_relationships && data.public_official_relationships.length > 0) {
                                data.public_official_relationships.forEach(rel => {
                                    const relDiv = document.createElement('div');
                                    relDiv.innerHTML = `<p><strong>Official Name:</strong> ${rel.gov_int_name || 'N/A'}, <strong>Relationship:</strong> ${rel.relation_desc || 'N/A'}, <strong>Position:</strong> ${rel.official_position || 'N/A'}, <strong>Branch/Org:</strong> ${rel.branch_orgname || 'N/A'}</p>`;
                                    viewPublicOfficialRelationshipsList.appendChild(relDiv);
                                });
                            }
                            checkAndAddNoRecordsMessage(viewPublicOfficialRelationshipsList);

                        })
                        .catch(error => {
                            console.error('Error fetching customer details:', error);
                            document.getElementById('customerDetailsContent').innerHTML = '<p class="text-danger">Failed to load customer details.</p>';
                        });
                });
            }


            // --- Edit Customer Modal ---
            const editCustomerModal = document.getElementById('editCustomerModal');
            if (editCustomerModal) {
                const editCompanyAffiliationList = document.getElementById('edit_company_affiliations_list');
                const editAddCompanyAffiliationBtn = document.getElementById('edit_add_company_affiliation');
                const editBankList = document.getElementById('edit_existing_banks_list');
                const editAddBankBtn = document.getElementById('edit_add_existing_bank');
                const editRelationshipList = document.getElementById('edit_public_official_relationships_list');
                const editAddRelationshipBtn = document.getElementById('edit_add_public_official_relationship');

                // Function to add a company affiliation entry for Edit Modal
                editAddCompanyAffiliationBtn.addEventListener('click', function() {
                    addDynamicListItem('edit_company_affiliations_list', companyAffiliationTemplate);
                });

                // Function to add a bank account entry for Edit Modal
                editAddBankBtn.addEventListener('click', function() {
                    addDynamicListItem('edit_existing_banks_list', existingBankTemplate);
                });

                // Function to add a relationship entry for Edit Modal
                editAddRelationshipBtn.addEventListener('click', function() {
                    addDynamicListItem('edit_public_official_relationships_list', publicOfficialRelationshipTemplate);
                });

                // Listen for when the edit modal is shown to populate it
                editCustomerModal.addEventListener('show.bs.modal', function (event) {
                    const button = event.relatedTarget; // Button that triggered the modal
                    const customerId = button.getAttribute('data-customer-id'); 
                    const editCustomerForm = document.getElementById('editCustomerForm');
                    editCustomerForm.action = `/admin/edit_customer/${customerId}`; // Set form action for POST

                    // Fetch customer data using an API call
                    fetch(`/admin/customer/${customerId}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            // Populate personal info
                            document.getElementById('edit_customerId').value = customerId;
                            document.getElementById('edit_firstName').value = data.customer.custname.split(' ')[0] || '';
                            document.getElementById('edit_lastName').value = data.customer.custname.split(' ')[1] || '';
                            document.getElementById('edit_datebirth').value = data.customer.datebirth || '';
                            document.getElementById('edit_nationality').value = data.customer.nationality || '';
                            document.getElementById('edit_citizenship').value = data.customer.citizenship || '';
                            document.getElementById('edit_custsex').value = data.customer.custsex || '';
                            document.getElementById('edit_placebirth').value = data.customer.placebirth || '';
                            document.getElementById('edit_civilstatus').value = data.customer.civilstatus || '';
                            document.getElementById('edit_num_children').value = data.customer.num_children || '0';
                            document.getElementById('edit_mmaiden_name').value = data.customer.mmaiden_name || '';
                            document.getElementById('edit_cust_address').value = data.customer.cust_address || '';
                            document.getElementById('edit_email_address').value = data.customer.email_address || '';
                            document.getElementById('edit_contact_no').value = data.customer.contact_no || '';
                            document.getElementById('edit_registration_status').value = data.customer.registration_status || 'Pending';

                            // Populate spouse info
                            if (data.spouse) {
                                document.getElementById('edit_sp_name').value = data.spouse.sp_name || '';
                                document.getElementById('edit_sp_datebirth').value = data.spouse.sp_datebirth || '';
                                document.getElementById('edit_sp_profession').value = data.spouse.sp_profession || '';
                            } else {
                                document.getElementById('edit_sp_name').value = '';
                                document.getElementById('edit_sp_datebirth').value = '';
                                document.getElementById('edit_sp_profession').value = '';
                            }

                            // Populate employment info
                            document.getElementById('edit_occ_type').value = data.occupation.occ_type || '';
                            document.getElementById('edit_bus_nature').value = data.occupation.bus_nature || '';
                            if (data.employer_details) {
                                document.getElementById('edit_tin_id').value = data.employer_details.tin_id || '';
                                document.getElementById('edit_empname').value = data.employer_details.empname || '';
                                document.getElementById('edit_emp_address').value = data.employer_details.emp_address || '';
                                document.getElementById('edit_phonefax_no').value = data.employer_details.phonefax_no || '';
                                document.getElementById('edit_job_title').value = data.employer_details.job_title || '';
                                document.getElementById('edit_emp_date').value = data.employer_details.emp_date || '';
                            } else {
                                document.getElementById('edit_tin_id').value = '';
                                document.getElementById('edit_empname').value = '';
                                document.getElementById('edit_emp_address').value = '';
                                document.getElementById('edit_phonefax_no').value = '';
                                document.getElementById('edit_job_title').value = '';
                                document.getElementById('edit_emp_date').value = '';
                            }

                            // Populate financial info
                            document.getElementById('edit_mon_income').value = data.financial_record.mon_income || '';
                            document.getElementById('edit_ann_income').value = data.financial_record.ann_income || '';

                            // Populate Source of Wealth checkboxes
                            const editSourceOfWealthCheckboxes = document.querySelectorAll('#editSourceOfWealthCheckboxes input[type="checkbox"]');
                            editSourceOfWealthCheckboxes.forEach(checkbox => {
                                checkbox.checked = false; // Uncheck all first
                            });
                            if (data.financial_record.source_wealth) {
                                const sources = data.financial_record.source_wealth.split(', ').map(s => s.trim());
                                sources.forEach(val => {
                                    const checkbox = document.querySelector(`#editSourceOfWealthCheckboxes input[value="${val}"]`);
                                    if (checkbox) {
                                        checkbox.checked = true;
                                    }
                                });
                            }

                            // Clear and repopulate dynamic lists for editing
                            editCompanyAffiliationList.innerHTML = ''; 
                            if (data.company_affiliations && data.company_affiliations.length > 0) {
                                data.company_affiliations.forEach(aff => {
                                    const tempDiv = document.createElement('div');
                                    tempDiv.innerHTML = companyAffiliationTemplate;
                                    const newItem = tempDiv.firstElementChild;
                                    newItem.querySelector('[name="depositor_role[]"]').value = aff.depositor_role || '';
                                    newItem.querySelector('[name="dep_compname[]"]').value = aff.dep_compname || '';
                                    editCompanyAffiliationList.appendChild(newItem);
                                    newItem.querySelector('.remove-item-btn').addEventListener('click', function() {
                                        newItem.remove();
                                        checkAndAddNoRecordsMessage(editCompanyAffiliationList);
                                    });
                                });
                            }
                            checkAndAddNoRecordsMessage(editCompanyAffiliationList);


                            editExistingBanksList.innerHTML = '';
                            if (data.existing_banks && data.existing_banks.length > 0) {
                                data.existing_banks.forEach(bank => {
                                    const tempDiv = document.createElement('div');
                                    tempDiv.innerHTML = existingBankTemplate;
                                    const newItem = tempDiv.firstElementChild;
                                    newItem.querySelector('[name="bank_name[]"]').value = bank.bank_name || '';
                                    newItem.querySelector('[name="branch[]"]').value = bank.branch || '';
                                    newItem.querySelector('[name="acc_type[]"]').value = bank.acc_type || '';
                                    editExistingBanksList.appendChild(newItem);
                                    newItem.querySelector('.remove-item-btn').addEventListener('click', function() {
                                        newItem.remove();
                                        checkAndAddNoRecordsMessage(editExistingBanksList);
                                    });
                                });
                            }
                            checkAndAddNoRecordsMessage(editExistingBanksList);


                            editPublicOfficialRelationshipsList.innerHTML = '';
                            if (data.public_official_relationships && data.public_official_relationships.length > 0) {
                                data.public_official_relationships.forEach(rel => {
                                    const tempDiv = document.createElement('div');
                                    tempDiv.innerHTML = publicOfficialRelationshipTemplate;
                                    const newItem = tempDiv.firstElementChild;
                                    newItem.querySelector('[name="gov_int_name[]"]').value = rel.gov_int_name || '';
                                    newItem.querySelector('[name="official_position[]"]').value = rel.official_position || '';
                                    newItem.querySelector('[name="branch_orgname[]"]').value = rel.branch_orgname || '';
                                    const relationshipSelect = newItem.querySelector('[name="relation_desc[]"]');
                                    if (relationshipSelect) {
                                        relationshipSelect.value = rel.relation_desc || '';
                                    }
                                    editPublicOfficialRelationshipsList.appendChild(newItem);
                                    newItem.querySelector('.remove-item-btn').addEventListener('click', function() {
                                        newItem.remove();
                                        checkAndAddNoRecordsMessage(editPublicOfficialRelationshipsList);
                                    });
                                });
                            }
                            checkAndAddNoRecordsMessage(editPublicOfficialRelationshipsList);

                            // Source of Wealth Checkbox Limit for Edit Customer Modal
                            const editSourceOfWealthCheckboxesInModal = editCustomerModal.querySelectorAll('input[name="source_wealth[]"]');
                            editSourceOfWealthCheckboxesInModal.forEach(checkbox => {
                                checkbox.addEventListener('change', function (event) {
                                    if (event.target.name === 'source_wealth[]' && event.target.type === 'checkbox') {
                                        const checkedCount = editCustomerModal.querySelectorAll('input[name="source_wealth[]"]:checked').length;
                                        if (checkedCount > 3) {
                                            event.target.checked = false;
                                            // Provide user feedback without using alert()
                                            let messageContainer = editCustomerModal.querySelector('#editSourceOfWealthMessage');
                                            if (!messageContainer) {
                                                const parentDiv = event.target.closest('.checkbox-group');
                                                if (parentDiv) {
                                                    messageContainer = document.createElement('div');
                                                    messageContainer.id = 'editSourceOfWealthMessage';
                                                    messageContainer.classList.add('text-warning', 'mt-2'); // Bootstrap classes for warning text
                                                    parentDiv.parentNode.appendChild(messageContainer);
                                                }
                                            }
                                            if (messageContainer) {
                                                messageContainer.textContent = 'You can select up to three sources of wealth only.';
                                                setTimeout(() => {
                                                    messageContainer.textContent = ''; // Clear message after 3 seconds
                                                }, 3000);
                                            }
                                        } else {
                                            const messageContainer = editCustomerModal.querySelector('#editSourceOfWealthMessage');
                                            if (messageContainer) {
                                                messageContainer.textContent = '';
                                            }
                                        }
                                    }
                                });
                            });

                        })
                        .catch(error => {
                            console.error('Error fetching customer details for edit:', error);
                            alert('Failed to load customer details for editing.'); // Placeholder for user feedback
                        });
                });
            }

            // --- Delete Customer Modal ---
            const confirmDeleteModal = document.getElementById('confirmDeleteModal');
            if (confirmDeleteModal) {
                confirmDeleteModal.addEventListener('show.bs.modal', function (event) {
                    const button = event.relatedTarget; // Button that triggered the modal
                    const customerId = button.getAttribute('data-customer-id'); // Extract info from data-* attributes
                    const deleteForm = document.getElementById('deleteCustomerForm');
                    const deleteCustomerIdInput = document.getElementById('delete_customerId');

                    deleteCustomerIdInput.value = customerId;
                    // Assuming your delete endpoint is /delete_customer (handled by POST form)
                    // The action is already set on the form, just need to set the hidden input value
                });
            }
        });
    </script>
</body>
</html>
